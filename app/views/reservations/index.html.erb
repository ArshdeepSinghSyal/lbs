<p id="notice"><%= notice %></p>

<h1>All Reservations</h1>
<br>
A fine of $<%= @library.fine %> per day will be levied if a book is not returned within <%= @library.max_days %> days of issue.
</br></br>
<table>
  <thead>
    <tr>
      <% if current_user.usertype == "admin" || current_user.usertype == "librarian" %>
        <th>User Name</th>
        <th>User Email</th>
      <% end %>
      <th>Title</th>
      <th>Status</th>
      <th>Checkout Time</th>
      <th>Return Time</th>
      <th>Request Time</th>
      <th>Overdue Fine</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @reservations.each do |reservation| %>
      <tr>
        <% if current_user.usertype == "admin" || current_user.usertype == "librarian"
          @user = User.find_by_id(reservation.user_id)
        %>
          <td><%=  @user.name %></td>
          <td><%=  @user.email %></td>
        <% end %>
        <td><%= Book.find_by_id(reservation.lib_book.book_id).title %></td>
        <% if reservation.status == 0 %>
          <td> Returned </td>
        <% elsif reservation.status == 1 %>
          <td> Checked out </td>
        <% elsif reservation.status == 2 %>
          <td> Requested </td>
        <% else %>
          <td> Unknown </td>
        <% end %>
        <td><%= reservation.checkoutstamp %></td>
        <td><%= reservation.returnstamp %></td>
        <td><%= reservation.requeststamp %></td>
        <td><%= reservation.fine %></td>

        <td><%= link_to 'View Details', university_library_reservation_path(@university, @library, reservation) %></td>
        <% if reservation.status == 2 %>
          <td><%= link_to 'Destroy', university_library_reservation_path(@university, @library, reservation), method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<%= link_to 'Back', university_library_path(@university, @library) %>